{% extends 'customer/base.html' %}
{% block content %}
<style>
    .table tr {font-size: 12px;}
    .table td {font-size: 12px;}

     .tbl-fixed {
       overflow-x: scroll;
       overflow-y: scroll;
       height: fit-content;
       max-height:600px;
         height: 650px;
    }

    .table{
    min-width:max-content;
    }

    .table th{
    position:sticky;
    top: 0px;
    background:#405189;
</style>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="page-content">
    <div class="container-fluid">
        <!-- start page title -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h4 class="mb-sm-0">Swaps Entry</h4>

                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                            <li class="breadcrumb-item active">Swaps Entry</li>
                        </ol>
                    </div>

                </div>
            </div>
        </div>
        <!-- end page title -->

        <!--end row-->

        <div class="row">
            <div class="col-lg-12">
                <div class="card" id="tasksList">
                    <div class="card-header border-0">
                        <div class="d-flex align-items-center">
                            <h5 class="card-title mb-0 flex-grow-1">Swaps Entry</h5>
                            <div class="flex-shrink-0">

                            </div>
                        </div>
                    </div>
                    <div class="card-body border border-dashed border-end-0 border-start-0">
                        <form>
                            <div class="row g-3">
                                <div class="col-sm-6">
<!--                                    <div class="search-box">-->
<!--                                        -->
<!--                                    </div>-->

                                    <input type="text" class="form-control bg-light border-light" name="search_query" id="demo-datepicker" data-provider="flatpickr" data-date-format="d M, Y" data-range-date="true" placeholder="Search..." value="{{request.GET.search_query}}">

                                </div>
                                <!--end col-->

<!--                                <div class="col-xxl-4 col-sm-6">-->
<!--                                    <input type="text" class="form-control bg-light border-light" name="search_query" id="demo-datepicker" data-provider="flatpickr" data-date-format="d M, Y" data-range-date="true" placeholder="Search with Contract Name" value="{{request.GET.search_query}}">-->
<!--                                </div>-->
                                <!--end col-->

    
                                <!--end col-->
                                <div class=" col-sm-1">
                                    <button type="submit" class="btn btn-primary w-100" onclick="SearchData();"> <i class="ri-search-2-line"></i>
               
                                    </button>
                                </div>

                                <div class="col-sm-1">
                                    <button type="button" class="btn btn-primary w-100" onclick="window.location.href='/swaps-blotter'"> <i class="ri-close-circle-line"></i>
            
                                    </button>
                                </div>


                                <div class=" col-sm-3">
                                    <p class="btn btn-danger add-btn" data-bs-toggle="modal" data-bs-target="#showModal"><i class="ri-add-line align-bottom me-1"></i> Create Contract</p>
                                    <p class="btn btn-success add-btn" data-bs-toggle="modal" data-bs-target="#showModal4"><i class="ri-add-line align-bottom me-1"></i> Upload file</p>
<!--                                    <p class="btn btn-info add-btn" type="submit" ><i class="ri-file-download-line align-bottom me-1"></i> Export</p>-->

                                </div>

                                <div class="col-sm-1">
                                             <a href="/export_sb_csv_today" class="btn btn-info" data-mdb-toggle="button" aria-pressed="true"
                                     role="button"><i class="ri-file-download-line align-bottom me-3"></i>Export</a>

                                   </div>




                       

                                <!--end col-->
                            </div>
                            <!--end row-->
                        </form>
                    </div>
                    <!--end card-body-->
                    <div class="card-body">
                        <div class="table-responsive tbl-fixed">

                            <div class="outer-wrapper">
                                <div class="table-wrapper">
                            <table id="alternative-pagination" class="table  dt-responsive align-middle table-hover table-bordered " style="width:100%;">

                                <thead class="text-white" style="background:#405189;">
                                    {% for messages in messages %}
                                    <div id="snackbar">{{messages}}</div>
                                    {% endfor %}
                                    <tr>
                                        <th style="text-align: center;">Sl No</th>
                                        <th data-sort="project_name">Action</th>
                                        <th style="text-align: center;">Date</th>
                                        <th style="text-align: center;">Trade ID</th>
                                        <th style="text-align: center;">Trade Type</th>
                                        <th style="text-align: center;">Clearer</th>
                                        <th style="text-align: center;">Trader</th>
                                        <th style="text-align: center;">Book</th>
                                        <th style="text-align: center;">Customer Company</th>
                                        <th style="text-align: center;">Customer Account</th>
                                        <th style="text-align: center;">Strategy</th>
                                        <th style="text-align: center;">Derivatives</th>
                                        <th style="text-align: center;">Volume</th>
                                        <th style="text-align: center;">Contract Name</th>
                                        <th style="text-align: center;">Start Date</th>
                                        <th style="text-align: center;">End Date</th>
                                        <th style="text-align: center;">Price</th>
                                        <th style="text-align: center;">Aproximate Ep</th>
                                        <th style="text-align: center;">Holiday</th>
                                        <th style="text-align: center;">Type</th>
                                        <th style="text-align: center;">EFSC Code</th>
                                        <th style="text-align: center;">Broker</th>
                                        <th   data-sort="project_name">Block Fee</th>
                                         <th  data-sort="project_name">Screen Fee</th>
                                         <th data-sort="project_name">Brokerage</th>

                                               <th  data-sort="project_name">bbl/MT</th>
                                        <th  data-sort="project_name">kbbl/MT</th>
                                                <th data-sort="project_name">Physical Code </th>
                                        <th data-sort="project_name">Physical Blotter ID </th>




<!--                                        #calculated values-->
                                       <!--                                        #calculated value-->
                                        <th data-sort="project_name">Major/Mini</th>
                                        <th data-sort="project_name">Major/Mini Connection</th>
                                         <th data-sort="project_name">Tick</th>
                                         <th data-sort="project_name">Unit</th>
                                        <th style="text-align: center;">Single/Diff</th>
                                         <th data-sort="project_name">FW Months</th>
                                        <th data-sort="project_name">Total Days</th>
<!--                                         <th data-sort="project_name">New  Total Days</th>-->


                                        <th data-sort="project_name">Priced Days</th>
                                        <th  data-sort="project_name">Unpriced Days</th>
                                         <th  data-sort="project_name">Total Volume</th>
                                         <th  data-sort="project_name">Priced volume</th>
                                         <th data-sort="project_name">Unpriced Volume</th>




                                        <th   data-sort="project_name">Total Fee</th>


                                        <th  data-sort="project_name">bbl Conversion Value</th>

                                        <th data-sort="project_name">Unpriced kbbl/MT</th>
                                        <th data-sort="project_name">First Month</th>
                                        <th data-sort="project_name">Second Month</th>
                                          <th data-sort="project_name">Futures Equiv First kbbl </th>
                                        <th data-sort="project_name">Futures Equiv Second kbbl </th>
                                           <th data-sort="project_name">First Month Days </th>
                                        <th data-sort="project_name">Second Month Days </th>
                                        <th data-sort="project_name">Futures Equiv First Month </th>
                                           <th data-sort="project_name">Futures Equiv Second Month </th>

<!--                                        # excluded from claculation-->
                                        <th data-sort="project_name">Notes</th>
<!--                                         <th data-sort="project_name">Action</th>-->

                                    </tr>
                                </thead>
                                <tbody id="tableBodyTrader" class="list form-check-all">
                                    {% for messages in messages %}
                                    <p data-toast data-toast-text="{{messages}}" data-toast-gravity="top" id="messages" data-toast-position="center" data-toast-duration="3000" data-toast-close="close"></p>
                                    {% endfor %}


                                    {%if page_obj %}

                                    {% for data in page_obj %}
                                    <tr>
                                       
                                        <td style="text-align: center;"class="id">{{forloop.counter}}</td>


                                          <td>
                                                    <div class="dropdown d-inline-block">
                                                        <button class="btn btn-soft-secondary btn-sm dropdown" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                            <i class="ri-more-fill align-middle"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end">
                                                            <li><a href="/swaps-blotter-detail/{{data.id}}" class="dropdown-item"><i class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a></li>
                                                            <li><a class="dropdown-item edit-item-btn" href="/edit-swaps-blotter/{{data.id}}"><i class="ri-pencil-fill align-bottom me-2 text-muted"></i> Edit</a></li>
                                                            <li>
<!--                                                                <a class="dropdown-item remove-item-btn" data-bs-toggle="modal" href="#deleteOrder" onclick="deletefunc('{{data.id}}')">-->
<!--                                                                    <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i> Delete-->
<!--                                                                </a>-->

                                                                <a class="dropdown-item edit-item-btn"  href="/delete-swaps-blotter/{{data.id}}">
                                                                <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>Delete</a></li>


                                                            <li><a href="/copy-swaps-blotter/{{data.id}}" class="dropdown-item"><i class="ri-file-copy-line align-bottom me-2 text-muted"></i> Copy</a></li>
<!--

</a>-->


<!--                                                            </li>-->
                                                        </ul>
                                                    </div>
                                                </td>




                                        <td style="text-align: center;"class="id">{{data.date}}</td>
                                          <td class="id">{{data.Trade_id}}</td>
                                        <td style="text-align: center;"class="id">{{data.trader_type}}</td>
                                        <td style="text-align: center;"class="id">{{data.clearer}}</td>
                                        <td style="text-align: center;"class="id">{{data.trader.name}}</td>
                                        <td style="text-align: center;"class="id">{{data.book}}</td>
                                        <td style="text-align: center;"class="id">{{data.customer_company}}</td>
                                        <td style="text-align: center;"class="id">{{data.customer_account}}</td>
                                        <td style="text-align: center;"class="id">{{data.strategy.name}}</td>
                                        <td style="text-align: center;"class="id">{{data.derivatives}}</td>
                                        <td style="text-align: center;"class="id">{{data.volume}}</td>
                                        <td style="text-align: center;"class="id">{{data.contract}}</td>
                                        <td style="text-align: center;"class="id">{{data.start_date}}</td>
                                        <td style="text-align: center;"class="id">{{data.end_date}}</td>
                                        <td style="text-align: center;"class="id">{{data.price}}</td>
                                        <td style="text-align: center;"class="id">{{data.approx_ep}}</td>
                                        <td style="text-align: center;"class="id">{{data.holiday}}</td>
                                        <td style="text-align: center;"class="id">{{data.type}}</td>
                                        <td style="text-align: center;"class="id">{{data.efs_code}}</td>
                                        <td style="text-align: center;"class="id">{{data.broker}}</td>
                                        <td class="id">{{data.block_fee}}</td>
                                         <td class="id">{{data.screen_fee}}</td>
                                        <td class="id">{{data.Brokerage}}</td>

                                        <td class="id">{{data.bbi_mt}}</td>
                                         <td class="id">{{data.kbbl_mt_conversion}}</td>
                                         <td class="id">{{data.physical_code}}</td>
                                         <td class="id">{{data.physica_blotter_connect}}</td>


<!--                                        #CALCULATED VALUES-->
                                         <td style="text-align: center;"class="id">{{data.mini_major}}</td>
                                         <td style="text-align: center;"class="id">{{data.mini_major_connection}}</td>
                                        <td class="id">{{data.tick}}</td>
                                         <td class="id">{{data.unit}}</td>
                                         <td class="id">{{data.singl_dif}}</td>
                                        <td class="id">{{data.fw_months}}</td>
                                        <td style="text-align: center;"class="id">{{data.total_days}}</td>

<!--                                        #new totsl days-->
<!--                                        <td style="text-align: center;"class="id">{{data.total_n_days}}</td>-->


                                          <td class="id">{{data.priced_days}}</td>
                                      <td class="id">{{data.unpriced_days}}</td>
                                          <td class="id">{{data.total_volume}}</td>

                                          <td class="id">{{data.priced_volume}}</td>
                                          <td class="id">{{data.unpriced_volume}}</td>


                                          <td class="id">{{data.Total_Fee}}</td>

                                         <td class="id">{{data.bbi_mt_conversion}}</td>

                                        <td class="id">{{data.unpriced_kbbl_mt}}</td>
                                        <td class="id" >{{data.First_month}}</td>
                                        <td class="id">{{data.Second_month}}</td>
                                        <td class="id" >{{data.futures_equiv_first_kbbl}}</td>
                                        <td class="id">{{data.futures_equiv_second_kbbl}}</td>
                                         <td class="id" >{{data.first_month_days}}</td>
                                        <td class="id">{{data.second_month_days}}</td>
                                          <td class="id" >{{data.futures_equiv_first}}</td>
                                        <td class="id">{{data.futures_equiv_second}}</td>

                                          <td class="id">{{data.notes}}</td>

<!--                                        <td>-->
<!--                                               -->
<!--                                                    <ul >-->
<!--                                                        <li class="id list-inline-item"><a class="edit-item-btn" href="/edit-swaps-blotter/{{data.id}}"><i class="ri-pencil-fill align-bottom me-2 text-muted"></i></a></li>-->
<!--                                                        <li class="list-inline-item">-->
<!--                                                            <a class="remove-item-btn"  href="/delete-swaps-blotter/{{data.id}}">-->
<!--                                                                <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>-->
<!--                                                            </a>-->
<!--                                                        </li>-->
<!--                                                    </ul>-->
<!--                                        </td>-->
                                 
                                    </tr>
                                    {% endfor %}
                                 {% else %}
                                <tr><td>No Data Found</td></tr>
                            {% endif %}
                                </tbody>
                            </table>

                                </div>
                            </div>


                               </div>
                    </div>
                            <!--end table-->
                            <div class="noresult" style="display: none">
                                <div class="text-center">
                                    <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#121331,secondary:#08a88a" style="width:75px;height:75px"></lord-icon>
                                    <h5 class="mt-2">Sorry! No Result Found</h5>
                                    <p class="text-muted mb-0">We've searched more than 200k+ tasks We did not find any tasks for you search.</p>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end mt-2">
                            <div class="pagination-wrap hstack gap-2">
                                {% if page_obj.has_previous %}
                                <a class="page-item pagination-prev" href="?page={{ page_obj.previous_page_number }}">
                                    Previous
                                </a>
                                {% endif %}
                                <ul class="pagination listjs-pagination mb-0"></ul>
                                <p style="
                                margin-bottom: 0px;
                            "class="page-item pagination-next">{{ page_obj.number }}</p>
                                <ul class="pagination listjs-pagination mb-0"></ul>
                                {% if page_obj.has_next %}
                                <a class="page-item pagination-next" href="?page={{ page_obj.next_page_number }}">
                                    Next
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!--end card-body-->
                </div>
                <!--end card-->
            </div>
            <!--end col-->
        </div>
        <!--end row-->
        <form method="post">
            {% csrf_token %}
        
        <div class="modal fade flip" id="deleteOrder" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body p-5 text-center">
                        <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px"></lord-icon>
                        <div class="mt-4 text-center">
                            <input type="hidden" name="delet_id" id="delete_feild" value="">
                            <h4>Are You Sure You want To delete</h4>
                            <p class="text-muted fs-14 mb-4">Deleting your task will remove all of
                                your information from our database.</p>
                            <div class="hstack gap-2 justify-content-center remove">
                                <button type="reset" class="btn btn-link btn-ghost-success fw-medium text-decoration-none" id="deleteRecord-close" data-bs-dismiss="modal"><i class="ri-close-line me-1 align-middle"></i> Close</button>
                                <button type="submit" class="btn btn-danger" id="delete-record">Yes, Delete It</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
        <!--end delete modal -->

        <div class="modal fade zoomIn" id="showModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0">
                    <div class="modal-header p-3 bg-soft-info">
                        <h5 class="modal-title" id="exampleModalLabel">Edit Contract

                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                    </div>
                    <form class="tablelist-form" method="post" id="trader_from" autocomplete="off">
                        {% csrf_token %}
                        <div class="modal-body">
                            <input type="hidden" id="tasksId" />
                            <div class="row g-3">
                                <div class="col-lg-12">
                                   
                                    <label for="projectName-field" class="form-label">Name</label>
                                    <input type="hidden" id="edit_id" name="edit_name_id" value="">
                                    <input type="text"  name="edit_name" id="value_field" value="" class="form-control" placeholder="Contract name" required />
                                </div>
                                <!--end col-->

                                <!--end col-->
                            </div>
                            <!--end row-->
                        </div>
                        <div class="modal-footer">
                            <div class="hstack gap-2 justify-content-end">
                                <button type="button" class="btn btn-light" id="close-modal" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-success" id="add-btn" >Add Contract</button>
                                <!-- <button type="button" class="btn btn-success" id="edit-btn">Update Task</button> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade zoomIn" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0">
                    <div class="modal-header p-3 bg-soft-info">
                        <h5 class="modal-title" id="exampleModalLabel">Add Swaps Trade</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                    </div>

                    
                    
                    <form onsubmit="validateForm(event)" method="post" >
                        {% csrf_token %}
                        
                        <div class="row g-3" style="padding:20px;">
                            
                            <div class="col-sm-4">
                                <p><b>Date</b></p>
                                <input type="Date" class="form-control" name="date" id="date_id" aria-label="First-Name" required >
                            </div><!--end col-->
                            <div class="col-sm-4">
                                <p class="labelsa"><b>Trade Type</b><p>
                                <select class="form-select" id="singlediff" name="bileteral_external" onchange="enabledisable_ext()">
                                    <option value="choose" selected>Select</option>
                                    <option value="Bilateral">Bilateral</option>
                                    <option value="External">External</option>

                                </select>
                            </div>
                            <div class="col-sm-4">
                                <p class="labelsa"><b>Clearear</b></p>
                         
                                <label class="visually-hidden" for="inlineFormSelectPref">Clearear</label>
                                <select class="form-select" name="clearer" id="clearer_iid" onchange="ClearerChange()">
                                    <option value="choose" selected>Select</option>
                                    {% for i in clearer %}
                                    <option value="{{i}}">{{i}}</option>
                                    {% endfor %}
            
                                </select>
                            </div>






                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Trader</b><p>
                               
                                    <label class="visually-hidden" for="inlineFormSelectPref">Trader</label>
                                    <select class="form-select" id="trader" name="trader">
                                        <option value="choose" selected>Select</option>
                                        {% for i in trader %}
                                        <option value="{{i.id}}">{{i.name}}</option>
                                        {% endfor %}
                
                                    </select>                             </div>




                                    <div class="col-sm-3">
                                        <p class="labelsa"><b>Book</b><p>
                                    
                                        <label class="visually-hidden" for="inlineFormSelectPref">Book</label>
                                        <select class="form-select" id="book" name="book">
                                            <option value="choose" selected>Select</option>
                                            {% for i in book %}
                                            <option value="{{i.name}}">{{i.name}}</option>
                                            {% endfor %}
                    
                                        </select>                             </div>


                                        <div class="col-sm-3">
                                            <p class="labelsa"><b>Customer Company</b><p>
                                        
                                            <label class="visually-hidden" for="inlineFormSelectPref">Customer Company</label>
                                            <select class="form-select" id="customerCompanyId" name="customer_company" onchange="customerCompanyFun()">
                                                <option value="choose" selected>Select</option>
                                                {% for i in customer_company %}
                                                <option value="{{i.Customer_Company_name}}">{{i.Customer_Company_name}}</option>
                                                {% endfor %}

                        
                                            </select>                             </div>



                        
                                    <div class="col-sm-3">
                                        <p class="labelsa"><b>Account</b><p>
                                  
                                        <label class="visually-hidden" for="inlineFormSelectPref">Account</label>
                                        <select class="form-select" id="account_id" name="company_account">
                                            <option value="choose" selected>Select</option>
                                     
                    
                                        </select>                             </div>
                                    <div class="col-sm-3">
                                        <p class="labelsa"><b>Strategy</b></p>

                                        <select class="form-select" name="strategy" id="strategy">
                                            <option value="choose" selected>Select</option>
                                            {% for i in strategy %}
                                            <option value="{{i.id}}">{{i.name}}</option>

                                            {% endfor %}
                                            
                    
                                        </select>                             </div>


                                        <div class="col-sm-3">
                                            <p class="labelsa"><b>Derivatives</b></p>
                                     
                                            <label class="visually-hidden" for="inlineFormSelectPref">Clearear</label>
                                            <select class="form-select" name="derivatives"  id="derivative_id" >
                                                <option value="Swaps" selected>Swaps</option>
                                             
                        
                                            </select>
                                        </div>



                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Buy/Sell</b></p>

                                    <input type="text" class="form-control" id="buy_sell" placeholder="" name="buy_sell" aria-label="First-Name" value="" required readonly >
                                </div>


                             <div class="col-sm-3">
                                    <p class="labelsa"><b>Volume(lots)</b></p>
                                    <input type="text" class="form-control"  id="volume" onchange="buySell()" placeholder="" name="volume" aria-label="First-Name" required>
                                </div>







                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Contract Name</b></p>
                                    <label class="visually-hidden" >Contract Name 1</label>
                                    <select class="form-select"  name="contract_name" id="contract1" onchange="contractNameHolidayRelation()">
                                        <option selected>Select</option>

                                    </div>

                                        <br>
                                        <div class="col-sm-12">
                                            <input type="hidden" class="form-control">
                                        </div>


                                <div class="col-sm-3">
                                      <p class="labelsa"><b>Unit</b><p>
<!--                                    <input type="text" class="form-control" name="unit_c"  id="unit_idc" placeholder="" aria-label="First-Name"  readonly>-->

                                  <select class="form-select" id="unit_idc" name="unit_c">
                                            <option value="" selected></option>

                                        </select>



                                </div>

                              <div class="col-sm-3">
                                      <p class="labelsa"><b>Tick</b><p>
<!--                                    <input type="text" class="form-control" name="tick_c" id="tick_idc" placeholder="" aria-label="First-Name" readonly>-->

                                           <select class="form-select" id="tick_idc" name="tick_c">
                                            <option value="" selected></option>

                                        </select>

                                </div>

                                     



                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Start Date</b></p>
                                    <input type="date" name="start_date" class="form-control" placeholder="Major Mini Conn" aria-label="First-Name" id="start_date" onchange="FindEndDateofMonth()" required>
                                </div>


                                <div class="col-sm-3">
                                    <p class="labelsa"><b>End date</b></p>
                                    <input type="date" name="end_date" class="form-control" placeholder="" aria-label="First-Name" id="end_date" required>
                                </div>

                                
                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Price</b></p>
                                    <input type="text" class="form-control" name="price"  placeholder="" aria-label="First-Name" required>
                                </div>

                                
                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Approx. Executed Price</b></p>
                                    <input type="text" class="form-control" name="approximate_ep" id="approximate_ep_id" placeholder="" aria-label="First-Name" >
                                </div>

                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Holiday</b></p>
                                   
                                    <select class="form-select" id="holiday"  name="holiday" required  readonly="readonly">
                                        <option selected >Select</option>
                                        {% for unit in unit %}
                                        <option value="{{unit.name}}" >{{unit.name}}</option>
                                        {% endfor %}
                          
                                                            </div>

                                                            <div class="col-sm-3">
                                                                <p class="labelsa"></p>
                                                             
                                                                <select class="form-select"  name="unit" required>
                                

                                                                                        </div>
                                        


                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Type</b></p>
                                    <label class="visually-hidden" >Type</label>
                                    <select class="form-select"  name="type" required id="typeid">
                                        <option value="choose" >Select</option>
                                        {% for i in type %}
                                        <option value="{{i.name}}" >{{i.name}}</option>
                                        {% endfor %}
                          
                                                            </div>
            
<br>
                                                            <div class="col-sm-12">
                                                                <input type="hidden" class="form-control"  placeholder="BBi/Mt Conversion" aria-label="First-Name" >

                                                            </div>
                                


                           

<!--                              <div class="col-sm-4">-->
<!--                                    <p class="labelsa"><b>Physical Blotter ID</b></p>-->
<!--                                    <input type="text" class="form-control" name="pb_id" id="pb_id" placeholder="" aria-label="First-Name" >-->
<!--                                </div>-->



                                <div class="col-sm-3">
                                     <p class="labelsa"><b>EFS Code</b></p>
                                    <input type="text" class="form-control" name="efs_code" placeholder="" aria-label="First-Name" >
                                </div>

                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Broker</b></p>
                                    <label class="visually-hidden" >Broker</label>
                                    <select class="form-select" name="brocker" id="brocker_id" required>
                                        <option selected >Select</option>
                          
                                                            </div>
            
<br>

                                <div class="col-sm-3">
                                    <input type="hidden" class="form-control" name="physical_code" placeholder=" " aria-label="First-Name" >
                                </div>




                                <div class="col-sm-3">
                                    <p class="labelsa"><b>Notes</b></p>
                                    <input type="text" class="form-control" name="notes" placeholder="" aria-label="First-Name">
                                </div>
                                <div class="col-12">
        <div class="text-end">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </div>
                        </div><!--end row-->
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade zoomIn" id="showModal4" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0">
                    <div class="modal-header p-3 bg-soft-info">
                        <h5 class="modal-title" id="exampleModalLabel">Create Contract</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                    </div>

                    
                    
                    <form class="tablelist-form" method="post" id="trader_from" autocomplete="off" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="modal-body">
                            <input type="hidden" id="tasksId" />
                            <div class="row g-3">
                                <div class="col-lg-12">
                                    <label for="projectName-field" class="form-label">Name</label>
                                    <input type="file"  name="file" id="projectName-field" class="form-control" placeholder="Contract name" required />
                                </div>
                                <!--end col-->

                                <!--end col-->
                            </div>
                            <!--end row-->
                        </div>
                        <div class="modal-footer">
                            <div class="hstack gap-2 justify-content-end">
                                <button type="button" class="btn btn-light" id="close-modal" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-success" id="add-btn" >Upload file</button>
                                <!-- <button type="button" class="btn btn-success" id="edit-btn">Update Task</button> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--end modal-->

    </div>
    <!-- container-fluid -->
</div>

{% endblock %}

{% block javascript %}

function deletefunc(id){

    document.querySelector('#delete_feild').value=id
}




function validateForm(event){
    var startdate = document.querySelector('#start_date').value;
    var enddate = document.querySelector('#end_date').value;

    var tradetype = document.querySelector('#singlediff').value;
    var clearer = document.querySelector('#clearer_iid').value;
    var trader = document.querySelector('#trader').value;
    var book = document.querySelector('#book').value;
    var strategy = document.querySelector('#strategy').value;
    var contractname = document.querySelector('#contract1').value;
    var type = document.querySelector('#typeid').value;
    var customercompany = document.querySelector('#customerCompanyId').value;




    console.log(enddate)

    if (startdate>enddate){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Please Check Start Date and End Date',
            footer: 'Date Error'
          })
    }
    if (tradetype=='choose'){
            event.preventDefault()
            Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Trade Type Should not be null Please choose External or Bilateral',
                    footer: 'Trade Type Error'
                  })
            }

       if (customercompany=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Customer Company Should not be null Please choose Customer Company',
            footer: 'Trade Type Error'
          })
    }


    if (clearer=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'clearer Should not be null PLease choose clearer',
            footer: ' clearer Error'
          })
    }

     if (trader=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Trader Should not be null Please choose Trader',
            footer: 'Trader Error'
          })
    }
    if (book=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Book Should not be null Please choose Book',
            footer: 'Book Error'
          })
    }


    if (strategy=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Strategy  Should not be null Please choose  Strategy Number',
            footer: 'Strategy Error'
          })
    }

    if (contractname=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Contract Name  Should not be null Please choose  Contract Name',
            footer: 'Contract Name Error'
          })
    }

    if (type=='choose'){
        event.preventDefault()
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Type  Should not be null Please choose  Type',
            footer: 'Type Error'
          })
    }







    else{
        return true;
    }
}



async function FindEndDateofMonth(){
    var startdate = document.querySelector('#start_date').value;
    var enddate = document.querySelector('#end_date')


    await fetch('enddate_of_month', { // add comma after URL
        method: 'POST', // fix colon to comma
        headers:{
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({'start_date':startdate}) // fix method name to stringify
    })

    .then(response => response.json())
    .then(data => {
        console.log('sss')

        enddate.value= data.data


    })
}








async function contractNameHolidayRelation(){
    var contract = document.querySelector('#contract1').value;
    var holiday = document.querySelector('#holiday')
    const brocker_input = document.querySelector('#brocker_id')

    const unit_get = document.querySelector('#unit_idc')
    const tick_get = document.querySelector('#tick_idc')


    await fetch('contract_name_holiday_relation', { // add comma after URL
        method: 'POST', // fix colon to comma
        headers:{
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({'contract_name':contract}) // fix method name to stringify
    })
    .then(response => response.json())
    .then(data => {
        console.log('sss')
        console.log(data.data1.length)


<!--        unit_get.value= data.data3-->
<!--        tick_get.value= data.data4-->




        while (holiday.firstChild){
            holiday.removeChild(holiday.firstChild)
        }
        
        for (let i=0; i < data.data.length; i++){
            const option = document.createElement('option')
            option.value = data.data[i].date
            option.text = data.data[i].date
            holiday.append(option)
        }
        console.log('reached')
        
        while (brocker_input.firstChild){
            brocker_input.removeChild(brocker_input.firstChild)
        }
       
        for (let i=0; i < data.data1.length; i++){
            console.log('reachedss')
            const option = document.createElement('option')
            option.value = data.data1[i].data
            option.text = data.data1[i].data
            brocker_input.append(option)
        }


        while (unit_get.firstChild){
            unit_get.removeChild(unit_get.firstChild)
         }

        for (let i=0; i < data.data3.length; i++){
            console.log('reachedss')
            const option = document.createElement('option')
            option.value = data.data3[i].data
            option.text = data.data3[i].data
            unit_get.append(option)
        }


       while (tick_get.firstChild){
            tick_get.removeChild(tick_get.firstChild)
         }

        for (let i=0; i < data.data4.length; i++){
            console.log('reachedss')
            const option = document.createElement('option')
            option.value = data.data4[i].data
            option.text = data.data4[i].data
            tick_get.append(option)
        }

        
    })
}



async function ClearerChange(){
    const clearer_name = document.querySelector('#clearer_iid').value
    const derivative_id = 'swaps'
     fetch(`swaps_bloters_clearer_derivative`,{
        method:"POST",
        headers:{
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body:JSON.stringify({'clearer':clearer_name})
     })
    
    .then (response => response.json())
    .then (data => {
        console.log(data)
        while (contract1.firstChild){
            contract1.removeChild(contract1.firstChild)
        }
        const option = document.createElement('option')
        option.value ='choose'
        option.text = 'Select'
        document.querySelector('#contract1').append(option)
        for (i=0; i < data.data.length; i++){
        console.log(data.data[0].data)
        const option = document.createElement('option')
        option.value = data.data[i].data;
        option.text = data.data[i].data;
        document.querySelector('#contract1').append(option);
    }
   
   
    })
}



document.getElementById('date_id').valueAsDate = new Date();

function buySell(){
    const buy_sell = document.querySelector('#buy_sell')
    const volume = document.querySelector('#volume').value

    if (volume > 0){
        buy_sell.value='Buy'
        buy_sell.style.color = 'green';
    }

    else if(volume < 0){
        buy_sell.value='Sell'
  buy_sell.style.color = 'red';
    }
    
}




function customerCompanyFun(){
    const customer_company = document.querySelector('#customerCompanyId').value

    fetch(`search_customer_company/${customer_company}`)

    .then(response => response.json())
    .then(data => {
        console.log(data.company_name)
        const account_id = document.querySelector('#account_id')

        while (account_id.firstChild){
            account_id.removeChild(account_id.firstChild)
        }

        for (i=0; i < data.company_name.length; i++){
            const option = document.createElement('option');
            option.value = data.company_name[i].data
            option.text = data.company_name[i].data
            account_id.appendChild(option)
        }
    })
}


<!--#enable disable customer compnay account  approximate EP-->

function enabledisable_ext(){
    var option = document.querySelector('#singlediff').value;
    console.log(option)

    if (option == 'External'){
        document.getElementById("customerCompanyId").value = ""
        document.getElementById("customerCompanyId").disabled=true;
        document.getElementById("account_id").value = ""
        document.getElementById("account_id").disabled=true;
        document.getElementById("approximate_ep_id").value = ""
        document.getElementById("approximate_ep_id").disabled=true;
    }

    if (option == 'Bilateral'){
<!--        document.getElementById("customerCompanyId").value = ""-->
        document.getElementById("customerCompanyId").disabled=false;
<!--        document.getElementById("account_id").value = ""-->
        document.getElementById("account_id").disabled=false;
<!--        document.getElementById("approximate_ep_id").value = ""-->
        document.getElementById("approximate_ep_id").disabled=false;
    }

}

{% endblock %}